Soulslike Combat + NPC “Free Will”

Combat Pillars
- Weighty actions: startup, active, recovery windows; animation-driven.
- Stamina gating: attacks, rolls, blocks cost stamina; regen with delay.
- Lock-on targeting: strafe, camera focuses nearest target, switch with flick.
- I-frames: roll has invulnerability window; precise timing matters.

AI Pillars
- Utility AI: agents choose actions with scores based on needs and context.
- Goals: survive, pursue objectives, social needs (factions, quests).
- World events drive emergent stories; quests reflect agent goals.

Networking Plan (SpacetimeDB)
- Public tables: PlayerState, NPCState, Items, World.
- Reducers: request_attack, request_roll, hit_confirm, spawn_npc, update_goal.
- Server authoritative: validates stamina, hit windows, position deltas.
- Clients subscribe to states; interpolate movement.

Scenes & UI (Unity)
- Dedicated scenes: `ArmorCodexScene` and `ContractBoardScene` are generated by the Unity editor utility at `Tools/MMORPG/Create Sample Scenes`. Files: `Assets/Scenes/ArmorCodexScene.unity` and `Assets/Scenes/ContractBoardScene.unity`.
- Overworld scene includes panels:
  - World Boss Map (`WorldBossMapUI`)
  - Active Events list (`ActiveEventsUI`) showing event names and time until expiration
  - Marker managers for bosses and events

Buffs & Consumables
- Buff tiers: T1 (3–6%), T2 (6–11%), T3 (10–16%), T4 (15–24%), T5 (22–35%) for multiplicative effects. Flat effects (regen/shields) scale gently per tier.
- Stack rules:
  - Unique: only one active; reusing refreshes but does not stack power.
  - RefreshDuration: same buff refreshes its duration.
  - StackDiminishing: stacks up to 5 with 40% diminishing per extra stack.
- Caps: resistances cap at 75%, lifesteal at 20%, crit chance add at 75%.
- Categories: potion, tonic, elixir, meal, brew, tincture, scroll (long vs short buffs; economy-lever effects like drops/xp/gold on brew/tonic).
- Data: 500 consumables generated at `SpacetimeDB/design/consumables/data/consumables.json`. Generator: `design/consumables/generate_consumables.py`.
- Unity systems:
  - `BuffManager`: applies, tracks, and aggregates active buffs into `StatsModifiers`.
  - `ConsumableUse`: applies a consumable’s buffs and enforces per-item cooldown locally.
  - `ConsumablesScene` (Editor tool) lists all consumables and a live debug panel for testing.
  - Optional server call: when `SPACETIMEDB_SDK` is defined, `ConsumableUse` calls reducer `consume_consumable` before applying locally.

Server (SpacetimeDB)
- Tables: `consumable_catalog`, `consumable_effect`, `player_active_buff`, `player_consumable_cooldown`.
- Reducers:
  - `import_consumables(json)`: load 500 items into catalog/effects.
  - `grant_consumable_to_self(id, qty)`: add to inventory (`item` table).
  - `consume_consumable(id)`: checks cooldown and inventory, applies stacking rules, records active buff, sets per-item cooldown.
  - `clear_expired_buffs()`: deletes expired buff rows.


NPCs (Lore + Life Simulation)
- Data: 500 NPCs with lore/schedules generated at `SpacetimeDB/design/npcs/data/npcs.json` (generator: `design/npcs/generate_npcs.py`).
- Tables:
  - `npc`: id, name, faction, role, personality, home_region, bio
  - `npc_state`: npc_id, region_id, x/y/z, mood, activity, updated_at
  - `npc_memory`: id, npc_id, at, kind, description, importance
  - `npc_schedule`: id, npc_id, hour, activity, region_id, x/y/z
- Reducers:
  - `import_npcs(json)`: import batch (clears previous NPC data)
  - `tick_npcs(region_id, hour)`: advances each NPC in region toward scheduled location; updates activity; writes memory entries
  - `npc_remember(npc_id, kind, description, importance)`: append custom memories (e.g., encounters with players)
- Client bootstrapper: `NpcsBootstrapper` can import JSON at Play and call `tick_npcs` periodically.
